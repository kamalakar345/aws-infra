pipeline {
  agent { label 'aware-jenkins' }
  environment {
    region = "us-west-2"
  }
stages{

stage('Terragrunt-Init'){
        steps{
            dir('deployment') {
            script{
                    def BRANCH = "${env.BRANCH_NAME}.split("/")[1]"
                    
                    env.AWS_DEFAULT_PROFILE = "${BRANCH}"
                    sh "printenv"
                    sh "terragrunt --version"
                    sh "aws sts get-caller-identity"
                def folders = ["regional-private", "regional-public"]
                    for (int i = 0; i < folders.size(); ++i) { 
                        dir("${folders[i]}"){
                        sh  "terragrunt init --terragrunt-log-level debug --terragrunt-debug --reconfigure"
                        
                        // sh  "ls -lrta deployment/${folders[i]}"
                        }
                    
                    }
                }
            script{
                sh "tree"
            }
        }
            }
        }

}
}